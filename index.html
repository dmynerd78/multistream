<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Multi Chat</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="stream-gen">
        <div class="wrapper">
            <div class="input-group">
                <input type="text" placeholder="Username" required>
                <select>
                    <option value="twitch">Twitch</option>
                    <option value="mixer">Mixer</option>
                </select>
                <button onclick="addStream();">Add Stream</button>
                <button class="hide">Remove</button>
            </div>

            <div class="input-group">
                <input type="text" placeholder="Username" required>
                <select>
                    <option value="twitch">Twitch</option>
                    <option value="mixer">Mixer</option>
                </select>
                <button onclick="addStream();">Add Stream</button>
                <button onclick="removeDOMElement(this.parentElement);">Remove</button>
            </div>
        </div>

        <div id="extra-options">
            <span>Extra options
                <select id="noVideoChat">
                    <option></option>
                    <option title="No video embeds" value="novideo">No Video</option>
                    <option title="No chat embeds" value="nochat">No Chat</option>
                </select>
            </span>
            <br>
            <br>
            <label class="noselect" title="Hide small banner which separates strem chat and video">No Banner <input type="checkbox" id="noBanner"></label><br>
            <label class="noselect" title="Do not query site APIs for things like viewer count channel status">Don't Query Statistics <input type="checkbox" id="noAPICalls"></label><br>
        </div>
        <button id="submit" onclick="readInputStreams();">Submit</button>
        <span id="credit">Made by <a href="https://twitter.com/dmynerd78" target="_blank">@dmynerd78</a></span>
    </div>

    <div id="stream-chats" class="hidden"></div>

    <script src="utils.js"></script>
    <script src="stream.js"></script>
    <script>
        const STREAM_ROW = document.querySelector("#stream-gen .wrapper .input-group:nth-child(2)").cloneNode(true);

        // Example search: ?t:dmynerd78+t:CallMeCyber&novideo+nobanner
        var search = window.location.search.substr(1).split("&");
        var streams = search[0].split("+");
        if(search.length > 1) {
            var settings = search[1].split("+");
        } else {
            var settings = [];
        }
        console.log("Parsed arguments:");
        console.log(search);

        // Load streams from URL
        if(search[0] != "") {
            try {
                genColumns(streams, settings);
            } catch(e) {
                console.error(e);
                alert(e);
            }

        // Set focus to first input
        } else {
            window.onload = function () {
                document.querySelector("#stream-gen .wrapper .input-group :first-child").focus()
            };
        }

        // Used for disabling interactivity with iframes when resizing chat
        var resizeSheet = document.createElement("style");
        document.body.appendChild(resizeSheet);

        var chatHeightSheet = document.createElement("style");
        document.body.appendChild(chatHeightSheet);

        // Hide query statistics if banner is disabled
        document.getElementById("noBanner").addEventListener("change", (e) => {
            let node = document.getElementById("noAPICalls").parentElement;
            if(e.srcElement.checked) {
                node.classList.add("hide");
            } else {
                node.classList.remove("hide");
            }
        });
    </script>
</body>
</html>